<!DOCTYPE html>
<html>
  <head>
    <title>FitFace Settings</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.css" />
    <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.js"></script>
  </head>
  <body>
    <div data-role="page" id="main">
      <div data-role="header" class="jqm-header">
        <h1>FitFace Settings</h1>
      </div>

      <div data-role="content">

<div data-role="collapsible-set" data-theme="c" data-content-theme="d" data-mini="false">
    <div data-role="collapsible">
        <h3>Functionality</h3>

<fieldset data-role="controlgroup" data-type="vertical" data-mini="true">
    <legend>Bluetooth Disconnect Alert</legend>
        <input name="key0" id="key0-0" data-type="int" value="0" checked="checked" type="radio">
        <label for="key0-0">False</label>
        <input name="key0" id="key0-1" data-type="int" value="1" type="radio">
        <label for="key0-1">True</label>
</fieldset>

<fieldset data-role="controlgroup" data-type="vertical" data-mini="true">
    <legend>Bluetooth Reconnect Alert</legend>
        <input name="key1" id="key1-0" data-type="int" value="0" checked="checked" type="radio">
        <label for="key1-0">False</label>
        <input name="key1" id="key1-1" data-type="int" value="1" type="radio">
        <label for="key1-1">True</label>
</fieldset>
    </div>
    
        <div data-role="collapsible">
        <h3>Look and Feel</h3>

<fieldset data-role="controlgroup" data-type="vertical" data-mini="true">
    <legend>Date</legend>
        <input name="key3" id="key3-0" data-type="int" value="0" checked="checked" type="radio">
        <label for="key3-0">Show</label>
        <input name="key3" id="key3-1" data-type="int" value="1" type="radio">
        <label for="key3-1">Hide</label>
</fieldset>

<fieldset data-role="controlgroup" data-type="vertical" data-mini="true">
    <legend>Battery Bar</legend>
        <input name="key4" id="key4-0" data-type="int" value="0" checked="checked" type="radio">
        <label for="key4-0">Show</label>
        <input name="key4" id="key4-1" data-type="int" value="1" type="radio">
        <label for="key4-1">Hide</label>
</fieldset>
        
<fieldset data-role="controlgroup" data-type="vertical" data-mini="true">
    <legend>Theme</legend>
        <input name="key2" id="key2-0" data-type="int" value="0" type="radio">
        <label for="key2-0">Inverted</label>
        <input name="key2" id="key2-1" data-type="int" value="1" checked="checked" type="radio">
        <label for="key2-1">Classic</label>
</fieldset>

    </div>
    
            <div data-role="collapsible">
        <h3>Advanced</h3>

<fieldset data-role="controlgroup" data-type="vertical" data-mini="true">
    <legend>Debug</legend>
    <i>This will log input/output from the app to an app logger ie. CloudPebble/Natebean or terminal.</i>
        <input name="key5" id="key5-0" data-type="int" value="0" checked="checked" type="radio">
        <label for="key5-0">Hide (saves battery)</label>
        <input name="key5" id="key5-1" data-type="int" value="1" type="radio">
        <label for="key5-1">Show</label>
</fieldset>
    </div>
                <div data-role="collapsible">
        <h3>Custom Token</h3>
<p>Some iOS users experience issues with not getting data at all. If that's the case, go to the Fitbit page that says
  "Logged in as [name]" and copy the token that displays at the bottom of the page in bold. Paste it in this box below,
  hit save, and then close the watchface and open it again. It should load data properly.
</p>
<fieldset data-role="controlgroup" data-mini="true">
	 <legend><h4>Token</h4></legend>
	    <div class="ui-field-contain">
	      <input name="token" id="token" placeholder="324049j23o9hjf8u2jf9un..." value="1337" data-mini="true" type="text" maxlength="1000">
	    </div>
	</fieldset>
    </div>
</div>
<br />
        <div class="ui-body ui-body-c">
          <fieldset class="ui-grid-a">
              <div class="ui-block-a"><button type="submit" data-theme="d" id="b-cancel">Cancel</button></div>
              <div class="ui-block-b"><button type="submit" data-theme="a" id="b-submit">Save</button></div>
          </fieldset>
        </div>
      </div>
    </div>
    <script>
      function saveOptions() {
        var options = {
          //Bools, ints, etc.
          'btdisalert':     Number( $("input[name=key0]:checked").val() ),
      	  'btrealert':     Number( $("input[name=key1]:checked").val() ),
      	  'date':     Number( $("input[name=key3]:checked").val() ),
      	  'batterybar':     Number( $("input[name=key4]:checked").val() ),
      	  'theme':     Number( $("input[name=key2]:checked").val() ),
      	  'debug':     Number( $("input[name=key5]:checked").val() ),
      	  'token':     $("input[name=token]").val(),
        }
        console.log("Options: " + options);
        return options;
      }

      $().ready(function() {
       if (typeof window.localStorage !== "undefined") {
       	console.log("Not undefined :)");
        if (window.localStorage.fitface_ops) {
          ls_pto = JSON.parse(window.localStorage.fitface_ops);
          console.log("Changing check boxes");
          //Bools, ints, etc.
          $("input[name=key0][id=key0-"+ls_pto["btdisalert"]+"]").prop('checked',true);
          $("input[name=key0]").checkboxradio('refresh');
          $("input[name=key1][id=key1-"+ls_pto["btrealert"]+"]").prop('checked',true);
          $("input[name=key1]").checkboxradio('refresh');
          $("input[name=key2][id=key2-"+ls_pto["theme"]+"]").prop('checked',true);
          $("input[name=key2]").checkboxradio('refresh');
          $("input[name=key3][id=key3-"+ls_pto["date"]+"]").prop('checked',true);
          $("input[name=key3]").checkboxradio('refresh');
          $("input[name=key4][id=key4-"+ls_pto["batterybar"]+"]").prop('checked',true);
          $("input[name=key4]").checkboxradio('refresh');
          $("input[name=key5][id=key5-"+ls_pto["debug"]+"]").prop('checked',true);
          $("input[name=key5]").checkboxradio('refresh');
          
          $("input[name=token]").val(ls_pto["token"]);
        }
       }
        $("#b-cancel").click(function() {
          console.log("Cancel");
          document.location = "pebblejs://close";
          console.log(document.location);
        });

        $("#b-submit").click(function() {
          console.log("Submit");

          ls_pto = JSON.stringify(saveOptions());
          if (typeof window.localStorage !== "undefined") {
            window.localStorage.fitface_ops = ls_pto;
          }
          var location = "pebblejs://close#" + ls_pto;
          console.log("Warping to: " + location);
          console.log(location);
          document.location = location;
          console.log(document.location);
        });

      });
    </script>
  </body>
</html>
